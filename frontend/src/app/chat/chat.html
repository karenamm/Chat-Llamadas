<div class="chat-window">
  <div class="top-menu">
    <div class="buttons">
      <div class="button close"></div>
      <div class="button minimize"></div>
      <div class="button maximize"></div>
    </div>
    <div class="title">
      Chat - {{ roomId }}
    </div>
  </div>

  <!-- CONTROLES DE LLAMADA -->
  <div class="call-controls">
    <button (click)="startCall()" [disabled]="inCall">Iniciar llamada</button>
    <button (click)="endCall()" [disabled]="!inCall">Finalizar llamada</button>
  </div>

  <!-- LISTA DE MENSAJES -->
  <div class="messages">
    <div
      *ngFor="let msg of messages"
      class="message"
      [ngClass]="{ right: msg.user === username, left: msg.user !== username }"
    >
      <div class="avatar" [ngStyle]="{ 'background-color': getAvatarColor(msg.user) }">
        {{ msg.user[0] | uppercase }}
      </div>

      <div class="text-wrapper">
        <!-- Texto normal -->
        <div class="text" *ngIf="!msg.audio">{{ msg.message }}</div>

        <!-- Burbuja de audio estilo WhatsApp -->
        <div class="audio-bubble" *ngIf="msg.audio">
          <button class="audio-play" (click)="togglePlay(msg)">
            <span *ngIf="!msg.isPlaying">‚ñ∂</span>
            <span *ngIf="msg.isPlaying">‚è∏</span>
          </button>

          <div class="audio-track" (click)="seek(msg, $event)">
            <div class="audio-progress" [style.width.%]="(msg.currentTime / (msg.audio.duration || 1)) * 100"></div>
          </div>

          <div class="audio-times">
            <span class="audio-time">{{ formatTime(msg.currentTime) }}</span>
            <span class="audio-duration">{{ formatTime(msg.audio.duration) }}</span>
          </div>
        </div>

        <div class="meta" *ngIf="msg.createdAt">
          {{ msg.createdAt | date:'shortTime' }}
        </div>
      </div>
    </div>
  </div>

  <!-- INPUT Y ACCIONES (tipo WhatsApp) -->
  <div class="bottom-wrapper">
    <input
      [(ngModel)]="message"
      class="message-input"
      placeholder="Escribe un mensaje..."
      (keyup.enter)="sendMessage()"
    />

    <button class="send-button" (click)="sendMessage()">Enviar</button>

    <!-- Push-to-talk: Mantener para grabar -->
    <button
      class="ptt-button"
      (mousedown)="pttDown($event)"
      (mouseup)="pttUp($event)"
      (mouseleave)="pttCancel($event)"
      (touchstart)="pttDown($event)"
      (touchend)="pttUp($event)"
      (touchcancel)="pttCancel($event)"
      [class.recording]="isRecording"
      title="Mant√©n para grabar nota de voz"
    >
      üéôÔ∏è
    </button>
  </div>

  <!-- Barra de grabaci√≥n -->
  <div class="recording-bar" *ngIf="isRecording">
    <div class="dot"></div>
    <div class="label">Grabando‚Ä¶ {{ recordElapsed | date:'mm:ss':'UTC' }}</div>
    <div class="hint">Suelta para enviar</div>
  </div>

  <!-- AUDIO REMOTO DE LLAMADA -->
  <audio #remoteAudio autoplay></audio>
</div>
